<div class="dashboard-container">
  <h1>Panel de administrador</h1>

  <!-- ASESORÍAS -->
  <div class="card panel-asesorias">
    <div class="card-header">
      <h2>Asesorías agendadas</h2>
    </div>
    
    <div class="card-body table-responsive">
      <table class="tabla-asesorias" *ngIf="asesorias.length; else sinAsesorias">
        <thead>
          <tr>
            <th>#</th>
            <th>Programador</th>
            <th>Cliente</th>
            <th>Correo</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Estado</th>
            <th>Descripción</th>
            <th>Mensaje programador</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of asesorias">
            <td>{{ a.id }}</td>
            <td>{{ a.programadorNombre || ('ID ' + a.programadorId) }}</td>
            <td>{{ a.nombreCliente }}</td>
            <td>{{ a.emailCliente }}</td>
            <td>{{ a.fecha }}</td>
            <td>{{ a.hora }}</td>
            <td>
              <span class="badge" [ngClass]="a.estado">
                {{ a.estado | titlecase }}
              </span>
            </td>
            <td>{{ a.descripcionProyecto }}</td>
            <td>{{ a.mensajeRespuesta || '—' }}</td>
          </tr>
        </tbody>
      </table>

      <ng-template #sinAsesorias>
        <div class="empty-state">
          <p>Todavía no hay asesorías agendadas.</p>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="grid-gestion">
    <!-- GESTIÓN DE PROGRAMADORES -->
    <div class="card panel-programadores">
      <div class="card-header">
        <h2>Gestión de programadores</h2>
      </div>
      
      <div class="card-body">
        <div class="form-section">
          <h3>
            {{ programadorEditandoId === null ? 'Registrar nuevo programador' : 'Editar programador' }}
          </h3>

          <form (ngSubmit)="crearProgramador()" #fProg="ngForm" class="form-estilizado">
            <div class="form-group">
              <label>Nombre</label>
              <input
                type="text"
                name="nombre"
                [(ngModel)]="nuevoProgramador.nombre"
                required
              />
            </div>

            <div class="form-group">
              <label>Especialidad</label>
              <input
                type="text"
                name="especialidad"
                [(ngModel)]="nuevoProgramador.especialidad"
                required
              />
            </div>

            <div class="form-group">
              <label>Descripción</label>
              <textarea
                name="descripcion"
                rows="3"
                [(ngModel)]="nuevoProgramador.descripcion"
                placeholder="Breve descripción..."
              ></textarea>
            </div>

            <div class="form-group">
              <label>Correo de contacto</label>
              <input type="email"
                    name="emailContacto"
                    [(ngModel)]="nuevoProgramador.emailContacto"
                    placeholder="ejemplo@correo.com" />
            </div>

            <div class="form-group">
              <label>GitHub (opcional)</label>
              <input type="url"
                    name="githubUrl"
                    [(ngModel)]="nuevoProgramador.githubUrl"
                    placeholder="https://github.com/usuario" />
            </div>

            <div class="form-group">
              <label>LinkedIn (opcional)</label>
              <input type="url"
                    name="linkedinUrl"
                    [(ngModel)]="nuevoProgramador.linkedinUrl"
                    placeholder="https://www.linkedin.com/in/usuario" />
            </div>

            <div class="form-group">
              <label>Sitio web / Portafolio personal (opcional)</label>
              <input type="url"
                    name="sitioWeb"
                    [(ngModel)]="nuevoProgramador.sitioWeb"
                    placeholder="https://mi-sitio.dev" />
            </div>


            <button type="submit" [disabled]="fProg.invalid" class="btn-primary">
              {{ programadorEditandoId === null ? 'Guardar programador' : 'Actualizar programador' }}
            </button>

            <button
              type="button"
              class="btn-secundario"
              *ngIf="programadorEditandoId !== null"
              (click)="cancelarEdicionProgramador()"
            >
              Cancelar
            </button>
          </form>
        </div>

        <hr class="separador" />

        <div class="lista-section">
          <h3>Programadores registrados</h3>
          <ul class="lista-items">
            <li *ngFor="let p of programadores">
              <div class="item-info">
                <strong>{{ p.nombre }}</strong>
                <span class="badge-light">{{ p.especialidad }}</span>
              </div>
              <p class="texto-pequeño">{{ p.descripcion }}</p>

              <div class="acciones-programador">
                <button type="button" (click)="editarProgramador(p)">
                  Editar
                </button>
                <button type="button" (click)="eliminarProgramador(p)">
                  Eliminar
                </button>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- HORARIOS -->
    <div class="card panel-horarios">
      <div class="card-header">
        <h2>Horarios de disponibilidad</h2>
      </div>

      <div class="card-body">
        <p *ngIf="mensajeDisponibilidad" class="mensaje-exito">
          {{ mensajeDisponibilidad }}
        </p>

        <div class="form-section">
          <h3>Registrar horario</h3>
          <form (ngSubmit)="crearDisponibilidad()" #fDisp="ngForm" class="form-estilizado">
            <div class="form-group">
              <label>Programador</label>
              <select
                name="programadorId"
                [(ngModel)]="nuevaDisponibilidad.programadorId"
                required
              >
                <option [ngValue]="0">Selecciona un programador</option>
                <option *ngFor="let p of programadores" [ngValue]="p.id">
                  {{ p.nombre }}
                </option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Fecha</label>
                <input
                  type="date"
                  name="fecha"
                  [(ngModel)]="nuevaDisponibilidad.fecha"
                  required
                />
              </div>
              <div class="form-group">
                <label>Hora</label>
                <input
                  type="time"
                  name="hora"
                  [(ngModel)]="nuevaDisponibilidad.hora"
                  required
                />
              </div>
            </div>

            <button type="submit" [disabled]="fDisp.invalid" class="btn-primary">
              Guardar horario
            </button>
          </form>
        </div>

        <hr class="separador" />

        <div class="lista-section">
          <h3>Horarios registrados</h3>
          <div class="table-responsive-small">
            <table class="tabla-simple" *ngIf="disponibilidades.length; else sinHorarios">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Programador</th>
                  <th>Fecha</th>
                  <th>Hora</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let d of disponibilidades">
                  <td>{{ d.id }}</td>
                  <td>{{ obtenerNombreProgramador(d.programadorId) }}</td>
                  <td>{{ d.fecha }}</td>
                  <td>{{ d.hora }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <ng-template #sinHorarios>
            <p class="text-muted">Aún no se han registrado horarios.</p>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- GESTIÓN DE USUARIOS -->
  <section class="seccion-usuarios">
    <h2>Gestión de usuarios</h2>
    <p>
      Administrador puede asignar roles y vincular usuarios con un portafolio de programador.
    </p>

    <table class="tabla-usuarios">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Rol</th>
          <th>Programador asignado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of usuarios">
          <td>{{ u.nombre }}</td>
          <td>{{ u.email || '—' }}</td>
          <td>
            <select [(ngModel)]="u.rol">
              <option *ngFor="let r of rolesPosibles" [ngValue]="r">
                {{ r }}
              </option>
            </select>
          </td>
          <td>
            <ng-container *ngIf="u.rol === 'programador'; else noProg">
              <select [(ngModel)]="u.programadorId">
                <option [ngValue]="null">Sin asignar</option>
                <option *ngFor="let p of programadores" [ngValue]="p.id">
                  {{ p.nombre }} (id: {{ p.id }})
                </option>
              </select>
            </ng-container>
            <ng-template #noProg>
              <span>—</span>
            </ng-template>
          </td>
          <td>
            <button (click)="guardarUsuario(u)">
              Guardar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
</div>
