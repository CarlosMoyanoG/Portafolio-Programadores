<div class="contenedor-panel">
  <h1>Panel de administrador</h1>

  <div class="tarjeta panel-asesorias">
    <div class="cabecera-tarjeta">
      <h2>Asesorías agendadas</h2>
    </div>
    
    <div class="cuerpo-tarjeta contenedor-tabla">
      <table class="tabla-asesorias" *ngIf="asesorias.length; else sinAsesorias">
        <thead>
          <tr>
            <th>#</th>
            <th>Programador</th>
            <th>Cliente</th>
            <th>Correo</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Estado</th>
            <th>Descripción</th>
            <th>Mensaje programador</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of asesorias">
            <td>{{ a.id }}</td>
            <td>{{ a.programadorNombre || ('ID ' + a.programadorId) }}</td>
            <td>{{ a.nombreCliente }}</td>
            <td>{{ a.emailCliente }}</td>
            <td>{{ a.fecha }}</td>
            <td>{{ a.hora }}</td>
            <td>
              <span class="insignia" [ngClass]="a.estado">
                {{ a.estado | titlecase }}
              </span>
            </td>
            <td>{{ a.descripcionProyecto }}</td>
            <td>{{ a.mensajeRespuesta || '—' }}</td>
          </tr>
        </tbody>
      </table>

      <ng-template #sinAsesorias>
        <div class="estado-vacio">
          <p>Todavía no hay asesorías agendadas.</p>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="cuadricula-gestion">
    <div class="tarjeta panel-programadores">
      <div class="cabecera-tarjeta">
        <h2>Gestión de programadores</h2>
      </div>
      
      <div class="cuerpo-tarjeta">
        <div class="seccion-formulario">
          <h3>
            {{ programadorEditandoId === null ? 'Registrar nuevo programador' : 'Editar programador' }}
          </h3>

          <form (ngSubmit)="crearProgramador()" #fProg="ngForm" class="formulario-estilizado">
            <div class="grupo-formulario">
              <label>Nombre</label>
              <input
                type="text"
                name="nombre"
                [(ngModel)]="nuevoProgramador.nombre"
                required
              />
            </div>

            <div class="grupo-formulario">
              <label>Especialidad</label>
              <input
                type="text"
                name="especialidad"
                [(ngModel)]="nuevoProgramador.especialidad"
                required
              />
            </div>

            <div class="grupo-formulario">
              <label>Descripción</label>
              <textarea
                name="descripcion"
                rows="3"
                [(ngModel)]="nuevoProgramador.descripcion"
                placeholder="Breve descripción..."
              ></textarea>
            </div>

            <div class="grupo-formulario">
              <label>Correo de contacto</label>
              <input type="email"
                    name="emailContacto"
                    [(ngModel)]="nuevoProgramador.emailContacto"
                    placeholder="ejemplo@correo.com" />
            </div>

            <div class="grupo-formulario">
              <label>GitHub (opcional)</label>
              <input type="url"
                    name="githubUrl"
                    [(ngModel)]="nuevoProgramador.githubUrl"
                    placeholder="https://github.com/usuario" />
            </div>

            <div class="grupo-formulario">
              <label>LinkedIn (opcional)</label>
              <input type="url"
                    name="linkedinUrl"
                    [(ngModel)]="nuevoProgramador.linkedinUrl"
                    placeholder="https://www.linkedin.com/in/usuario" />
            </div>

            <div class="grupo-formulario">
              <label>Sitio web / Portafolio personal (opcional)</label>
              <input type="url"
                    name="sitioWeb"
                    [(ngModel)]="nuevoProgramador.sitioWeb"
                    placeholder="https://mi-sitio.dev" />
            </div>


            <button type="submit" [disabled]="fProg.invalid" class="boton-primario">
              {{ programadorEditandoId === null ? 'Guardar programador' : 'Actualizar programador' }}
            </button>

            <button
              type="button"
              class="boton-secundario"
              *ngIf="programadorEditandoId !== null"
              (click)="cancelarEdicionProgramador()"
            >
              Cancelar
            </button>
          </form>
        </div>

        <hr class="separador" />

        <div class="seccion-lista">
          <h3>Programadores registrados</h3>
          <ul class="lista-items">
            <li *ngFor="let p of programadores">
              <div class="info-item">
                <strong>{{ p.nombre }}</strong>
                <span class="insignia-clara">{{ p.especialidad }}</span>
              </div>
              <p class="texto-pequeno">{{ p.descripcion }}</p>

              <div class="acciones-programador">
                <button type="button" class="boton-texto" (click)="editarProgramador(p)">
                  Editar
                </button>
                <button type="button" class="boton-texto boton-texto-peligro" (click)="eliminarProgramador(p)">
                  Eliminar
                </button>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="tarjeta panel-horarios">
      <div class="cabecera-tarjeta">
        <h2>Horarios de disponibilidad</h2>
      </div>

      <div class="cuerpo-tarjeta">
        <p *ngIf="mensajeDisponibilidad" class="mensaje-exito">
          {{ mensajeDisponibilidad }}
        </p>

        <!-- Horarios recurrentes -->
        <div class="seccion-formulario">
          <h3>Horario recurrente (semanal)</h3>
          <form
            (ngSubmit)="crearHorarioRecurrente()"
            #fRec="ngForm"
            class="formulario-estilizado"
          >
            <div class="grupo-formulario">
              <label>Programador</label>
              <select
                name="programadorIdRec"
                [(ngModel)]="formHorarioRecurrente.programadorId"
                required
              >
                <option [ngValue]="0">Selecciona un programador</option>
                <option *ngFor="let p of programadores" [ngValue]="p.id">
                  {{ p.nombre }}
                </option>
              </select>
            </div>

            <div class="grupo-formulario">
              <label>Días de la semana</label>
              <div class="cubos-dias">
                <label *ngFor="let d of diasSemana" class="cubos-dia">
                  <input
                    type="checkbox"
                    [checked]="formHorarioRecurrente.diasSeleccionados.includes(d.valor)"
                    (change)="toggleDiaRecurrente(d.valor, $event.target.checked)"
                  />
                  <span>{{ d.etiqueta }}</span>
                </label>
              </div>
            </div>

            <div class="fila-formulario">
              <div class="grupo-formulario">
                <label>Hora inicio</label>
                <input
                  type="time"
                  name="horaInicioRec"
                  [(ngModel)]="formHorarioRecurrente.horaInicio"
                  required
                />
              </div>
              <div class="grupo-formulario">
                <label>Hora fin</label>
                <input
                  type="time"
                  name="horaFinRec"
                  [(ngModel)]="formHorarioRecurrente.horaFin"
                  required
                />
              </div>
            </div>

            <button
              type="submit"
              [disabled]="fRec.invalid"
              class="boton-primario"
            >
              Guardar horario recurrente
            </button>
          </form>
        </div>

        <hr class="separador" />

        <!-- Bloqueos / excepciones -->
        <div class="seccion-formulario">
          <h3>Bloqueo / excepción</h3>
          <form
            (ngSubmit)="crearBloqueo()"
            #fBloq="ngForm"
            class="formulario-estilizado"
          >
            <div class="grupo-formulario">
              <label>Programador</label>
              <select
                name="programadorIdBloq"
                [(ngModel)]="formBloqueo.programadorId"
                required
              >
                <option [ngValue]="0">Selecciona un programador</option>
                <option *ngFor="let p of programadores" [ngValue]="p.id">
                  {{ p.nombre }}
                </option>
              </select>
            </div>

            <div class="grupo-formulario">
              <label>Fecha</label>
              <input
                type="date"
                name="fechaBloq"
                [(ngModel)]="formBloqueo.fecha"
                required
              />
            </div>

            <div class="grupo-formulario">
              <label>
                <input
                  type="checkbox"
                  name="todoElDia"
                  [(ngModel)]="formBloqueo.todoElDia"
                />
                Todo el día
              </label>
            </div>

            <div class="fila-formulario">
              <div class="grupo-formulario">
                <label>Hora inicio</label>
                <input
                  type="time"
                  name="horaInicioBloq"
                  [(ngModel)]="formBloqueo.horaInicio"
                  [disabled]="formBloqueo.todoElDia"
                />
              </div>
              <div class="grupo-formulario">
                <label>Hora fin</label>
                <input
                  type="time"
                  name="horaFinBloq"
                  [(ngModel)]="formBloqueo.horaFin"
                  [disabled]="formBloqueo.todoElDia"
                />
              </div>
            </div>

            <button
              type="submit"
              [disabled]="!formBloqueo.programadorId || !formBloqueo.fecha"
              class="boton-primario"
            >
              Guardar bloqueo
            </button>
          </form>
        </div>

        <hr class="separador" />

        <!-- Lista de registros -->
        <div class="seccion-lista">
          <h3>Registros de disponibilidad</h3>
          <div class="contenedor-tabla-pequena">
            <table
              class="tabla-simple"
              *ngIf="disponibilidades.length; else sinHorarios"
            >
              <thead>
                <tr>
                  <th>#</th>
                  <th>Programador</th>
                  <th>Tipo</th>
                  <th>Día / Fecha</th>
                  <th>Horario</th>
                  <th style="width: 80px;">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let d of disponibilidades">
                  <td>{{ d.id }}</td>
                  <td>{{ obtenerNombreProgramador(d.programadorId) }}</td>
                  <td>{{ d.tipo | titlecase }}</td>
                  <td>{{ descripcionDia(d) }}</td>
                  <td>{{ descripcionRango(d) }}</td>
                  <td>
                    <button type="button" class="boton-texto boton-texto-peligro" (click)="eliminarDisponibilidad(d)">
                      Eliminar
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <ng-template #sinHorarios>
            <p class="texto-tenue">Aún no se han registrado horarios.</p>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <div class="tarjeta panel-usuarios">
    <div class="cabecera-tarjeta">
      <h2>Gestión de usuarios</h2>
    </div>
    <div class="cuerpo-tarjeta">
        <p class="texto-descripcion">
            Administra roles y vincula usuarios con un perfil de programador.
        </p>

        <div class="contenedor-tabla">
            <table class="tabla-usuarios">
            <thead>
                <tr>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Rol</th>
                <th>Programador asignado</th>
                <th style="width: 100px;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let u of usuarios">
                <td><span class="texto-negrita">{{ u.nombre }}</span></td>
                <td>{{ u.email || '—' }}</td>
                <td>
                    <select [(ngModel)]="u.rol" class="select-pequeno">
                    <option *ngFor="let r of rolesPosibles" [ngValue]="r">
                        {{ r }}
                    </option>
                    </select>
                </td>
                <td>
                    <ng-container *ngIf="u.rol === 'programador'; else noProg">
                    <select [(ngModel)]="u.programadorId" class="select-pequeno">
                        <option [ngValue]="null">Sin asignar</option>
                        <option *ngFor="let p of programadores" [ngValue]="p.id">
                        {{ p.nombre }}
                        </option>
                    </select>
                    </ng-container>
                    <ng-template #noProg>
                    <span class="texto-tenue">—</span>
                    </ng-template>
                </td>
                <td>
                    <button class="boton-accion-pequeno" (click)="guardarUsuario(u)">
                    Guardar
                    </button>
                </td>
                </tr>
            </tbody>
            </table>
        </div>
    </div>
  </div>
</div>